#!/usr/bin/env bash
# Авто-запуск tmux с восстановлением последней сессии или новой сессии

if command -v tmux >/dev/null 2>&1; then
  if [[ -z "$TMUX" ]]; then
    # Считаем количество запущенных tmux-сессий
    TMUX_COUNT=$(pgrep -c tmux)

    RESURRECT_LAST="$HOME/.tmux/resurrect/last"
    
    if [[ $TMUX_COUNT -gt 1 ]]; then
      # Если уже есть 2 или больше сессий, запускаем новую
      tmux new-session
    elif [[ -f "$RESURRECT_LAST" ]]; then
      # Если есть сохраненная сессия, восстанавливаем ее
      tmux start-server
      "$HOME/.tmux/plugins/tmux-resurrect/scripts/restore.sh" &> /dev/null
      tmux attach-session
    else
      # Если нет сохраненной сессии, создаем новую сессию
      tmux new-session
    fi
  fi
fi
